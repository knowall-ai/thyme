= Thyme Troubleshooting Guide

Common issues and their solutions. Add new entries as problems are discovered and resolved.

|===
| Problem | Solution

| Auth redirect fails with "AADSTS50011" error
| Verify redirect URI in Azure App Registration matches `NEXT_PUBLIC_AZURE_REDIRECT_URI` exactly (including trailing slash if present)

| BC API returns 401 Unauthorized
| Check that BC API permissions are granted admin consent in Azure; verify token hasn't expired

| BC API returns 403 Forbidden
| User needs appropriate Business Central license and permissions assigned

| Projects dropdown is empty
| Verify `NEXT_PUBLIC_BC_COMPANY_ID` and `NEXT_PUBLIC_BC_ENVIRONMENT` are set (must have `NEXT_PUBLIC_` prefix for client-side access); check that `/projects` endpoint returns data (not `/jobs`)

| Team page shows no employees
| Ensure employees exist in BC with status 'Active'; check `/employees` endpoint

| Timer state lost on refresh
| Check browser allows localStorage; timer state persists in localStorage

| "missing required error components" on page load
| Clear `.next` folder and restart dev server: `rm -rf .next && npm run dev`

| Sign-in popup blocked
| App now uses redirect flow; if still seeing popups, clear cache and rebuild

| Logout doesn't work
| Verify `postLogoutRedirectUri` is set to `/` in AuthProvider; check for console errors

| TypeScript build errors after changes
| Run `npm run build` to see full errors; check that new types are exported from `src/types/index.ts`

| Tailwind classes not applying
| Ensure file is in `content` array in `tailwind.config.js`; avoid dynamic class string interpolation

| vitest/vite version conflict
| `vitest.config.ts` should be excluded in `tsconfig.json` exclude array

| Dev server on wrong port
| Ports 3000/3001 may be in use; check console output for actual port (e.g., 3002)

| BC API returns 404 on endpoint
| Verify the endpoint exists in BC API v2.0; some entities use different names (e.g., `projects` not `jobs`)

| Production auth fails with "AADSTS900144: client_id missing"
| `NEXT_PUBLIC_*` env vars are baked in at build time in Next.js, not runtime. Add them as GitHub secrets and include in the build step of `deploy-production.yml` workflow. Azure App Service settings alone won't work for client-side variables.

| "No Timesheet Available" message shown
| A timesheet must be created in BC before users can enter time for a week. Contact your timesheet manager to create timesheets for you. See Issue #61 for manager timesheet creation feature.

| "Thyme BC Extension is not installed" error
| The Timesheet API requires the Thyme BC Extension to be installed. Install from https://github.com/knowall-ai/thyme-bc-extension

| Timesheet shows as read-only
| Timesheets become read-only once submitted for approval. If rejected, click "Reopen for Editing" to make changes.

| Time entries not saving
| Ensure you have an Open or Rejected timesheet for the week. Submitted and Approved timesheets cannot be edited.

| "Could not find your resource record" error
| Your user account must have a matching Resource record in BC with a valid email address. Contact your BC administrator.

| "Resource Record Not Found" but BC extension check passes
| The extension's `/resources` API endpoint may not exist. This happens when using an older extension version or when the extension isn't fully installed. Reinstall the latest Thyme BC Extension from https://github.com/knowall-ai/thyme-bc-extension

|===
